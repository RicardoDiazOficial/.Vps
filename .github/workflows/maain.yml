name: VPS OptiOS 8.1 Corregido

on:
  workflow_dispatch:

jobs:
  windows-opti:
    runs-on: ubuntu-latest
    timeout-minutes: 360
    
    steps:
      - name: "1. Preparar KVM"
        run: |
          sudo apt-get update
          sudo chown $USER /dev/kvm
          
      - name: "2. Descargar y Desplegar Windows"
        run: |
          # Intentamos forzar la descarga de la imagen primero
          docker pull dockur/windows:latest
          
          # Ejecutamos con el nombre corregido
          docker run -d \
            --name=windows \
            --device=/dev/kvm \
            --cap-add NET_ADMIN \
            -p 8006:8006 \
            -e RAM_SIZE="14G" \
            -e CPU_CORES="4" \
            -e VERSION="8.1" \
            -e CUSTOM_ISO="https://www.mediafire.com/file/fbgdr9993u39ik6?dkey=bx8h6qzqtzq&r=1551" \
            dockur/windows
            
          echo "Esperando a que el contenedor inicie..."
          sleep 20

      - name: "3. Crear TÃºnel de Acceso"
        run: |
          # Usamos una imagen alternativa de Cloudflare por si acaso
          docker run --rm --net=host cloudflare/cloudflared:latest tunnel --url http://localhost:8006
